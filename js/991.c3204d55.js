"use strict";(self["webpackChunkfinal_project"]=self["webpackChunkfinal_project"]||[]).push([[991],{2389:function(t,e){e.A={data(){return{cart:{},isLoading:!1,cartItemCount:0,status:{loadingItem:""}}},methods:{getCart(){return new Promise(((t,e)=>{const a="https://vue3-course-api.hexschool.io/api/applehung1-api/cart";this.isLoading=!0,this.$http.get(a).then((e=>{console.log(e),this.cart=e.data.data,this.cartItemCount=this.cart.carts.reduce(((t,e)=>t+e.qty),0),this.isLoading=!1,t(e)})).catch((t=>{this.isLoading=!1,e(t)}))}))}},created(){this.getCart()}}},5991:function(t,e,a){a.r(e),a.d(e,{default:function(){return M}});var s=a(6768),o=a(4232),n=a(5130);const l={class:"col-md-7 mx-auto"},i={class:"top"},c=(0,s.Lk)("li",null,"/",-1),u=(0,s.Lk)("li",null,"購物車",-1),d=(0,s.Lk)("hr",null,null,-1),r=(0,s.Lk)("p",null,"購物清單",-1),p=(0,s.Lk)("hr",null,null,-1),h={class:"sticky-top"},k={class:"table align-middle"},L=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th"),(0,s.Lk)("th",null,"品名"),(0,s.Lk)("th",{style:{width:"110px"}},"數量"),(0,s.Lk)("th",null,"單價")])],-1),g=["disabled","onClick"],m=(0,s.Lk)("i",{class:"bi bi-x"},null,-1),b=[m],C={key:0,class:"text-success"},v={class:"input-group input-group-sm"},y=["disabled","onChange","onUpdate:modelValue"],f={class:"input-group-text"},x={class:"text-end"},_={key:0,class:"text-success"},I=(0,s.Lk)("td",{colspan:"3",class:"text-end"},"總計",-1),$={class:"text-end"},E={key:0},F=(0,s.Lk)("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),X={class:"text-end text-success"},q={class:"input-group mb-3 input-group-sm"},W={class:"input-group-append"},w={class:"text-center mt-3"},Q={class:"btn btn-outline-secondary mx-2",type:"button"},A={class:"btn btn-outline-secondary mx-2",type:"button"};function U(t,e,a,m,U,V){const j=(0,s.g2)("Loading"),J=(0,s.g2)("router-link");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.bF)(j,{active:t.isLoading},null,8,["active"]),(0,s.Lk)("div",l,[(0,s.Lk)("div",i,[(0,s.Lk)("ul",null,[(0,s.Lk)("li",null,[(0,s.bF)(J,{to:"/",class:"cart-router"},{default:(0,s.k6)((()=>[(0,s.eW)("首頁")])),_:1})]),c,u])]),d,r,p,(0,s.Lk)("div",h,[(0,s.Lk)("table",k,[L,(0,s.Lk)("tbody",null,[t.cart.carts?((0,s.uX)(!0),(0,s.CE)(s.FK,{key:0},(0,s.pI)(t.cart.carts,(e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.id},[(0,s.Lk)("td",null,[(0,s.Lk)("button",{type:"button",class:"btn btn-outline-danger btn-sm",disabled:t.status.loadingItem===e.id,onClick:t=>V.removeCartItem(e.id)},b,8,g)]),(0,s.Lk)("td",null,[(0,s.eW)((0,o.v_)(e.product.title)+" ",1),e.coupon?((0,s.uX)(),(0,s.CE)("div",C," 已套用優惠券 ")):(0,s.Q3)("",!0)]),(0,s.Lk)("td",null,[(0,s.Lk)("div",v,[(0,s.bo)((0,s.Lk)("input",{type:"number",class:"form-control",min:"1",disabled:e.id===t.status.loadingItem,onChange:t=>V.updateCart(e),"onUpdate:modelValue":t=>e.qty=t},null,40,y),[[n.Jo,e.qty,void 0,{number:!0}]]),(0,s.Lk)("div",f,"/ "+(0,o.v_)(e.product.unit),1)])]),(0,s.Lk)("td",x,[t.cart.final_total!==t.cart.total?((0,s.uX)(),(0,s.CE)("small",_,"折扣價：")):(0,s.Q3)("",!0),(0,s.eW)(" "+(0,o.v_)(t.$filters.currency(e.final_total)),1)])])))),128)):(0,s.Q3)("",!0)]),(0,s.Lk)("tfoot",null,[(0,s.Lk)("tr",null,[I,(0,s.Lk)("td",$,(0,o.v_)(t.$filters.currency(t.cart.total)),1)]),t.cart.final_total!==t.cart.total?((0,s.uX)(),(0,s.CE)("tr",E,[F,(0,s.Lk)("td",X,(0,o.v_)(t.$filters.currency(t.cart.final_total)),1)])):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",q,[(0,s.bo)((0,s.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=t=>U.coupon_code=t),placeholder:"請輸入優惠碼"},null,512),[[n.Jo,U.coupon_code]]),(0,s.Lk)("div",W,[(0,s.Lk)("button",{class:"btn btn-outline-secondary",type:"button",onClick:e[1]||(e[1]=(...t)=>V.addCouponCode&&V.addCouponCode(...t))}," 套用優惠碼 ")])])]),(0,s.Lk)("div",w,[(0,s.Lk)("button",Q,[(0,s.bF)(J,{class:"navbar-brand",to:"/user/list"},{default:(0,s.k6)((()=>[(0,s.eW)("繼續購物")])),_:1})]),(0,s.Lk)("button",A,[(0,s.bF)(J,{class:"navbar-brand",to:"/user/checkinfo"},{default:(0,s.k6)((()=>[(0,s.eW)("前往結帳")])),_:1})])])])],64)}var V=a(2389),j={emits:["cart-updated"],data(){return{coupon_code:""}},methods:{addCouponCode(){const t="https://vue3-course-api.hexschool.io/api/applehung1-api/coupon",e={code:this.coupon_code};this.$http.post(t,{data:e}).then((t=>{this.$httpMessageState(t,"加入優惠券"),console.log(t),this.getCart()}))},updateCart(t){const e=`https://vue3-course-api.hexschool.io/api/applehung1-api/cart/${t.id}`;this.isLoading=!0,this.status.loadingItem=t.id;const a={product_id:t.product_id,qty:t.qty};this.$http.put(e,{data:a}).then((t=>(console.log(t),this.status.loadingItem="",this.getCart()))).then((t=>{this.$emit("cart-updated",this.cart),console.log("觸發updateCart",this.cartItemCount)}))},removeCartItem(t){console.log("移除此項"),this.status.loadingItem=t;const e=`https://vue3-course-api.hexschool.io/api/applehung1-api/cart/${t}`;this.$http.delete(e).then((t=>(this.status.loadingItem="",console.log(t),this.getCart()))).then((t=>{this.$emit("cart-updated",this.cart),console.log("觸發removeCartItem",this.cartItemCount)}))}},mixins:[V.A]},J=a(1241);const K=(0,J.A)(j,[["render",U]]);var M=K}}]);
//# sourceMappingURL=991.c3204d55.js.map