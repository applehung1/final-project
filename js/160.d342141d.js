"use strict";(self["webpackChunkfinal_project"]=self["webpackChunkfinal_project"]||[]).push([[160],{2389:function(t,e){e.A={data(){return{cart:{},isLoading:!1,cartItemCount:0,status:{loadingItem:""}}},methods:{getCart(){return new Promise(((t,e)=>{const a="https://vue3-course-api.hexschool.io/api/applehung1-api/cart";this.isLoading=!0,this.$http.get(a).then((e=>{console.log(e),this.cart=e.data.data,this.cartItemCount=this.cart.carts.reduce(((t,e)=>t+e.qty),0),this.isLoading=!1,t(e)})).catch((t=>{this.isLoading=!1,e(t)}))}))}},created(){this.getCart()}}},6160:function(t,e,a){a.r(e),a.d(e,{default:function(){return z}});var n=a(6768),s=a(4232),o=a(5130);const l={key:0,class:"loading-overlay"},i={class:"col-md-7 mx-auto"},c={class:"top"},u=(0,n.Lk)("li",null,"/",-1),d=(0,n.Lk)("li",null,"購物車",-1),r=(0,n.Lk)("hr",null,null,-1),p=(0,n.Lk)("p",null,"購物清單",-1),h=(0,n.Lk)("hr",null,null,-1),k={class:"sticky-top"},L={class:"table align-middle"},b=(0,n.Lk)("thead",null,[(0,n.Lk)("tr",null,[(0,n.Lk)("th"),(0,n.Lk)("th",null,"品名"),(0,n.Lk)("th",{style:{width:"150px"}},"數量"),(0,n.Lk)("th",null,"單價")])],-1),m=["disabled","onClick"],g=(0,n.Lk)("i",{class:"bi bi-x"},null,-1),C=[g],y={key:0,class:"text-success"},v={class:"input-group input-group-sm"},f=["onClick"],x=["disabled","onChange","onUpdate:modelValue"],_=["onClick"],I={class:"input-group-text"},$={class:"text-end"},q={key:0,class:"text-success"},E=(0,n.Lk)("td",{colspan:"3",class:"text-end"},"總計",-1),X={class:"text-end"},F={key:0},Q=(0,n.Lk)("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),W={class:"text-end text-success"},w={class:"input-group mb-3 input-group-sm"},A={class:"input-group-append"},U={class:"text-center mt-3"},V={class:"btn btn-outline-secondary mx-2",type:"button"},j={class:"btn btn-outline-secondary mx-2",type:"button"};function J(t,e,a,g,J,K){const M=(0,n.g2)("Loading"),P=(0,n.g2)("router-link");return(0,n.uX)(),(0,n.CE)(n.FK,null,[t.isLoading?((0,n.uX)(),(0,n.CE)("div",l,[(0,n.bF)(M,{active:t.isLoading},null,8,["active"])])):(0,n.Q3)("",!0),(0,n.Lk)("div",i,[(0,n.Lk)("div",c,[(0,n.Lk)("ul",null,[(0,n.Lk)("li",null,[(0,n.bF)(P,{to:"/",class:"cart-router"},{default:(0,n.k6)((()=>[(0,n.eW)("首頁")])),_:1})]),u,d])]),r,p,h,(0,n.Lk)("div",k,[(0,n.Lk)("table",L,[b,(0,n.Lk)("tbody",null,[t.cart.carts?((0,n.uX)(!0),(0,n.CE)(n.FK,{key:0},(0,n.pI)(t.cart.carts,(e=>((0,n.uX)(),(0,n.CE)("tr",{key:e.id},[(0,n.Lk)("td",null,[(0,n.Lk)("button",{type:"button",class:"btn btn-outline-danger btn-sm",disabled:t.status.loadingItem===e.id,onClick:t=>K.removeCartItem(e.id)},C,8,m)]),(0,n.Lk)("td",null,[(0,n.eW)((0,s.v_)(e.product.title)+" ",1),e.coupon?((0,n.uX)(),(0,n.CE)("div",y," 已套用優惠券 ")):(0,n.Q3)("",!0)]),(0,n.Lk)("td",null,[(0,n.Lk)("div",v,[(0,n.Lk)("button",{class:"btn btn-outline-secondary",onClick:t=>K.decrement(e)},"-",8,f),(0,n.bo)((0,n.Lk)("input",{type:"number",class:"form-control",min:"1",disabled:e.id===t.status.loadingItem,onChange:t=>K.updateCart(e),"onUpdate:modelValue":t=>e.qty=t},null,40,x),[[o.Jo,e.qty,void 0,{number:!0}]]),(0,n.Lk)("button",{class:"btn btn-outline-secondary",onClick:t=>K.increment(e)},"+",8,_),(0,n.Lk)("div",I,"/ "+(0,s.v_)(e.product.unit),1)])]),(0,n.Lk)("td",$,[t.cart.final_total!==t.cart.total?((0,n.uX)(),(0,n.CE)("small",q,"折扣價：")):(0,n.Q3)("",!0),(0,n.eW)(" "+(0,s.v_)(t.$filters.currency(e.final_total)),1)])])))),128)):(0,n.Q3)("",!0)]),(0,n.Lk)("tfoot",null,[(0,n.Lk)("tr",null,[E,(0,n.Lk)("td",X,(0,s.v_)(t.$filters.currency(t.cart.total)),1)]),t.cart.final_total!==t.cart.total?((0,n.uX)(),(0,n.CE)("tr",F,[Q,(0,n.Lk)("td",W,(0,s.v_)(t.$filters.currency(t.cart.final_total)),1)])):(0,n.Q3)("",!0)])]),(0,n.Lk)("div",w,[(0,n.bo)((0,n.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=t=>J.coupon_code=t),placeholder:"請輸入優惠碼"},null,512),[[o.Jo,J.coupon_code]]),(0,n.Lk)("div",A,[(0,n.Lk)("button",{class:"btn btn-outline-secondary",type:"button",onClick:e[1]||(e[1]=(...t)=>K.addCouponCode&&K.addCouponCode(...t))}," 套用優惠碼 ")])]),(0,n.Lk)("div",U,[(0,n.Lk)("button",V,[(0,n.bF)(P,{class:"navbar-brand",to:"/user/list"},{default:(0,n.k6)((()=>[(0,n.eW)("繼續購物")])),_:1})]),(0,n.Lk)("button",j,[(0,n.bF)(P,{class:"navbar-brand",to:"/user/checkinfo"},{default:(0,n.k6)((()=>[(0,n.eW)("前往結帳")])),_:1})])])])])],64)}var K=a(2389),M={emits:["cart-updated"],data(){return{coupon_code:""}},methods:{addCouponCode(){const t="https://vue3-course-api.hexschool.io/api/applehung1-api/coupon",e={code:this.coupon_code};this.$http.post(t,{data:e}).then((t=>{this.$httpMessageState(t,"加入優惠券"),console.log(t),this.getCart()}))},updateCart(t){const e=`https://vue3-course-api.hexschool.io/api/applehung1-api/cart/${t.id}`;this.isLoading=!0,this.status.loadingItem=t.id;const a={product_id:t.product_id,qty:t.qty};this.$http.put(e,{data:a}).then((t=>(console.log(t),this.status.loadingItem="",this.getCart()))).then((t=>{this.$emit("cart-updated",this.cart),console.log("觸發updateCart",this.cartItemCount)}))},removeCartItem(t){console.log("移除此項"),this.status.loadingItem=t;const e=`https://vue3-course-api.hexschool.io/api/applehung1-api/cart/${t}`;this.$http.delete(e).then((t=>(this.status.loadingItem="",console.log(t),this.getCart()))).then((t=>{this.$emit("cart-updated",this.cart),console.log("觸發removeCartItem",this.cartItemCount)}))},increment(t){t.qty+=1,this.updateCart(t)},decrement(t){t.qty>1&&(t.qty-=1,this.updateCart(t))}},mixins:[K.A]},P=a(1241);const S=(0,P.A)(M,[["render",J]]);var z=S}}]);
//# sourceMappingURL=160.d342141d.js.map